import streamlit as st
from datetime import date

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(page_title="ç¦ç¥‰è·ã®å±¥æ­´æ›¸ãƒ¡ãƒ¼ã‚«ãƒ¼", layout="centered")

st.title("ğŸ“„ ç¦ç¥‰è·ã®ãŸã‚ã®å±¥æ­´æ›¸ãƒ¡ãƒ¼ã‚«ãƒ¼")
st.caption("é¢å€’ãªå…¥åŠ›ã¯ä¸è¦ã€‚ã‚¿ã‚°ã‚’é¸ã¶ã ã‘ã§ã€ãƒ—ãƒ­ã®ã‚ˆã†ãªè·å‹™çµŒæ­´æ›¸ãŒå®Œæˆã—ã¾ã™ã€‚")

# --- ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®åˆæœŸåŒ– ---
if "career_summary" not in st.session_state:
    st.session_state.career_summary = ""

# --- 1. åŸºæœ¬ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« ---
st.header("1. åŸºæœ¬æƒ…å ±")
col1, col2 = st.columns(2)
with col1:
    name = st.text_input("æ°å", placeholder="ä»‹è­· å¤ªéƒ")
with col2:
    # ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰å¹´é½¢ã‚’è‡ªå‹•è¨ˆç®—
    birthday = st.date_input("ç”Ÿå¹´æœˆæ—¥", date(1980, 1, 1), min_value=date(1950, 1, 1))
    today = date.today()
    age = today.year - birthday.year - ((today.month, today.day) < (birthday.month, birthday.day))
    st.info(f"ç¾åœ¨ {age}æ­³")

# --- 2. è·æ­´ï¼ˆã“ã“ãŒã€Œã‚­ãƒ£ãƒªã‚¢ç¿»è¨³ã€ã®æ ¸ã§ã™ï¼ï¼‰ ---
st.header("2. è·å‹™çµŒæ­´")
st.markdown("ç›´è¿‘ã®è·å ´ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ã€‚**æ–‡å­—ã‚’æ‰“ã¤å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚**")

# æ–½è¨­å½¢æ…‹ã®é¸æŠ
facility_type = st.selectbox("æ–½è¨­å½¢æ…‹", [
    "ç‰¹åˆ¥é¤Šè­·è€äººãƒ›ãƒ¼ãƒ ï¼ˆç‰¹é¤Šï¼‰",
    "è€äººä¿å¥æ–½è¨­ï¼ˆè€å¥ï¼‰",
    "ãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆé€šæ‰€ä»‹è­·ï¼‰",
    "è¨ªå•ä»‹è­·",
    "ã‚°ãƒ«ãƒ¼ãƒ—ãƒ›ãƒ¼ãƒ ",
    "æœ‰æ–™è€äººãƒ›ãƒ¼ãƒ ",
    "ç—…é™¢ï¼ˆçœ‹è­·åŠ©æ‰‹ï¼‰"
])

# æ¥­å‹™ã‚¿ã‚°ï¼ˆæ–½è¨­å½¢æ…‹ã«ã‚ˆã£ã¦å¤‰ãˆã‚‹ã®ãŒç†æƒ³ã§ã™ãŒã€ã¾ãšã¯å…±é€šã§å®Ÿè£…ï¼‰
st.subheader("æ‹…å½“ã—ã¦ã„ãŸæ¥­å‹™ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰")
tags = st.multiselect("å½“ã¦ã¯ã¾ã‚‹ã‚‚ã®ã‚’é¸ã‚“ã§ãã ã•ã„", [
    "èº«ä½“ä»‹è­·ï¼ˆå…¥æµ´ãƒ»æ’æ³„ãƒ»é£Ÿäº‹ï¼‰",
    "å¤œå‹¤æ¥­å‹™",
    "çœ‹å–ã‚Šã‚±ã‚¢",
    "èªçŸ¥ç—‡ã‚±ã‚¢",
    "ãƒ¬ã‚¯ãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ä¼ç”»ãƒ»é‹å–¶",
    "é€è¿æ¥­å‹™",
    "ã‚±ã‚¢ãƒ—ãƒ©ãƒ³ä½œæˆè£œåŠ©",
    "æ–°äººæŒ‡å°ãƒ»ãƒªãƒ¼ãƒ€ãƒ¼æ¥­å‹™",
    "å®¶æ—å¯¾å¿œãƒ»ç›¸è«‡æ´åŠ©"
])

# --- 3. ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã‚­ãƒ£ãƒªã‚¢ç¿»è¨³ï¼‰ ---
if st.button("è·å‹™çµŒæ­´æ›¸ã‚’ç”Ÿæˆã™ã‚‹", type="primary"):
    with st.spinner('ã‚ãªãŸã®çµŒé¨“ã‚’ã€Œæ¡ç”¨ã•ã‚Œã‚‹æ–‡ç« ã€ã«ç¿»è¨³ã—ã¦ã„ã¾ã™...'):
        import time
        time.sleep(1.5) # AIãŒè€ƒãˆã¦ã„ã‚‹æ¼”å‡º
        
        # æ–‡ç« ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæœ¬æ¥ã¯AIã‚’ä½¿ã„ã¾ã™ãŒã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã§ã‚‚ååˆ†å¼·åŠ›ã§ã™ï¼‰
        summary = f"ã€è·å‹™è¦ç´„ã€‘\n"
        summary += f"{facility_type}ã«ã¦ã€ä»‹è­·è·å“¡ã¨ã—ã¦å¾“äº‹ã„ãŸã—ã¾ã—ãŸã€‚\n"
        
        # ã‚¿ã‚°ã«åŸºã¥ãã€Œæ·±æ˜ã‚Šã€æ–‡ç« 
        details = []
        if "èº«ä½“ä»‹è­·ï¼ˆå…¥æµ´ãƒ»æ’æ³„ãƒ»é£Ÿäº‹ï¼‰" in tags:
            details.append("åˆ©ç”¨è€…ã®ADLã«åˆã‚ã›ãŸèº«ä½“ä»‹è­·ï¼ˆå…¥æµ´ã€æ’æ³„ã€é£Ÿäº‹ä»‹åŠ©ï¼‰ã‚’å®‰å…¨ç¬¬ä¸€ã«å®Ÿæ–½ã€‚")
        if "å¤œå‹¤æ¥­å‹™" in tags:
            details.append("å¤œå‹¤æ¥­å‹™ã‚’æ‹…å½“ã—ã€æ€¥å¤‰æ™‚å¯¾å¿œã‚„å¤œé–“ã®è¦‹å®ˆã‚Šã‚’è²¬ä»»ã‚’æŒã£ã¦é‚è¡Œã€‚")
        if "èªçŸ¥ç—‡ã‚±ã‚¢" in tags:
            details.append("èªçŸ¥ç—‡åˆ©ç”¨è€…ã«å¯¾ã—ã€ãƒ¦ãƒãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰ç­‰ã®æŠ€æ³•ã‚’æ„è­˜ã—ãŸä¸å¯§ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè·µã€‚")
        if "ãƒ¬ã‚¯ãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ä¼ç”»ãƒ»é‹å–¶" in tags:
            details.append("å­£ç¯€è¡Œäº‹ã‚„æ—¥å¸¸ãƒ¬ã‚¯ãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¼ç”»ãƒ»é‹å–¶ã‚’è¡Œã„ã€åˆ©ç”¨è€…ã®QOLå‘ä¸Šã«è²¢çŒ®ã€‚")
        if "çœ‹å–ã‚Šã‚±ã‚¢" in tags:
            details.append("ã‚¿ãƒ¼ãƒŸãƒŠãƒ«æœŸã®åˆ©ç”¨è€…ã«å¯¾ã—ã€å®¶æ—ã¨é€£æºã—ãªãŒã‚‰å°Šå³ã‚ã‚‹çœ‹å–ã‚Šã‚±ã‚¢ã‚’æä¾›ã€‚")
        if "æ–°äººæŒ‡å°ãƒ»ãƒªãƒ¼ãƒ€ãƒ¼æ¥­å‹™" in tags:
            details.append("ãƒ•ãƒ­ãƒªãƒ¼ãƒ€ãƒ¼ã¨ã—ã¦ã‚·ãƒ•ãƒˆç®¡ç†ã‚„æ–°äººè·å“¡ã®OJTæŒ‡å°ã‚’æ‹…å½“ã—ã€ãƒãƒ¼ãƒ ã®åº•ä¸Šã’ã«å°½åŠ›ã€‚")
            
        # çµåˆ
        summary += "".join(details)
        
        # è‡ªå·±PRã®è‡ªå‹•ç”Ÿæˆï¼ˆå¹´é½¢ã¨ã‚¿ã‚°ã«åˆã‚ã›ã¦å¤‰åŒ–ï¼‰
        pr = "\n\nã€è‡ªå·±PRã€‘\n"
        pr += f"ã“ã‚Œã¾ã§ã®{facility_type}ã§ã®çµŒé¨“ã‚’æ´»ã‹ã—ã€å³æˆ¦åŠ›ã¨ã—ã¦è²¢çŒ®ã„ãŸã—ã¾ã™ã€‚"
        if age >= 50:
            pr += "äººç”ŸçµŒé¨“ã‚’æ´»ã‹ã—ãŸã€åˆ©ç”¨è€…æ§˜ã®æ°—æŒã¡ã«å¯„ã‚Šæ·»ã†ä¸å¯§ãªã‚±ã‚¢ã‚’å¿ƒãŒã‘ã¦ãŠã‚Šã¾ã™ã€‚"
        else:
            pr += "ä½“åŠ›ã«ã¯è‡ªä¿¡ãŒã‚ã‚Šã€æ–°ã—ã„ç’°å¢ƒã§ã‚‚ç©æ¥µçš„ã«æ¥­å‹™ã‚’ç¿’å¾—ã—ã¦ã¾ã„ã‚Šã¾ã™ã€‚"

        final_text = summary + pr
        
        st.success("ç”Ÿæˆå®Œäº†ï¼")
        st.text_area("å±¥æ­´æ›¸ãƒ»è·å‹™çµŒæ­´æ›¸ç”¨ãƒ†ã‚­ã‚¹ãƒˆ", final_text, height=300)
        
        # --- ãƒãƒã‚¿ã‚¤ã‚ºå°ç·šï¼ˆã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆï¼‰ ---
        st.markdown("---")
        st.info(f"ğŸ’¡ **ã‚ãªãŸã®çµŒé¨“ï¼ˆ{facility_type} Ã— {len(tags)}ã‚¹ã‚­ãƒ«ï¼‰ã¯å¸‚å ´ä¾¡å€¤ãŒé«˜ã„ã§ã™ï¼**")
        st.markdown(f"ä»Šã®ã‚¹ã‚­ãƒ«ã§ã€çµ¦ä¸ãŒã„ãã‚‰ã«ãªã‚‹ã‹è¨ºæ–­ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ\n\n[ğŸ‘‰ **{facility_type}ã®éå…¬é–‹æ±‚äººã‚’è¦‹ã‚‹ï¼ˆç™»éŒ²ç„¡æ–™ï¼‰**](#)")
